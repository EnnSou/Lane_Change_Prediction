
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Post_normalization</title><meta name="generator" content="MATLAB 8.4"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2014-11-05"><meta name="DC.source" content="post_normalization_2.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Post_normalization</h1><!--introduction--><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Description</a></li><li><a href="#6">Combine five Videos together</a></li><li><a href="#7">Normalization all together</a></li><li><a href="#8">Not use ECG and BELT data right now</a></li><li><a href="#9">Seperate each Video</a></li><li><a href="#10">add target information here</a></li><li><a href="#11">Time Matching (generalize for ECG signals)</a></li><li><a href="#12">Generalization for Belt signal</a></li><li><a href="#13">Calculate the x(t) - x(t-stepsize)</a></li><li><a href="#14">Deal with ECG feature</a></li><li><a href="#15">Deal with BELT feature</a></li></ul></div><h2>Description<a name="1"></a></h2><pre>File type:    Executable file</pre><pre>Summary:
5 Features:</pre><div><ul><li>raw data</li><li>max value</li><li>min value</li><li>mean value</li><li>first order difference</li></ul></div><pre>Examples:</pre><pre class="codeinput"><span class="comment">%Provide sample usage code here</span>
</pre><pre>Algorithm:</pre><pre class="codeinput"><span class="comment">%df</span>
<span class="comment">%dsf</span>
<span class="comment">%  Author:       Yuan Ma</span>
<span class="comment">%  Date:         Oct.17.2014</span>
<span class="comment">%  Revision:     0.1</span>
<span class="comment">%  Partner:      Worked with Tianyu Wang, Yulong Li</span>
<span class="comment">%  Copyright:    Intelligent System Laboratory</span>
<span class="comment">%                University of Michigan Dearborn</span>
</pre><h2>Combine five Videos together<a name="6"></a></h2><pre class="codeinput">clc; clear <span class="string">all</span>; close <span class="string">all</span>;
ini = IniConfig();
ini.ReadFile(<span class="string">'configuration.ini'</span>);
Data_Path = ini.GetValues(<span class="string">'Path Setting'</span>, <span class="string">'DATA_PATH'</span>);
home = ini.GetValues(<span class="string">'Path Setting'</span>, <span class="string">'HOME_PATH'</span>);

total_feature = 5;

window_size_Ten_Hz_signals      = 20;
<span class="comment">% window size for ECG raw data is 256 because the sampling rate is 256 Hz</span>
window_size_ECG_raw             = 256 * 2;
<span class="comment">% window size for BELT raw data is 26 because the sampling rate is 26 Hz</span>
window_size_BELT_raw            = 26 * 2;

load(strcat(home, <span class="string">'\Synchronized_Dataset\statistics.mat'</span>));
<span class="comment">% get the number of signal selected</span>
<span class="comment">% get the lane change number</span>

num_signal_attributes   = 5;

<span class="keyword">for</span> m = 1:num_trips
    load(strcat(home, <span class="string">'\Post_normalization_Ouput\Video_'</span>, num2str(m), <span class="keyword">...</span>
        <span class="string">'_Ten_Hz_signals_feature.mat'</span>));
    <span class="comment">% dynamic generate varibles using eval function</span>
    <span class="comment">% the value of feature_pool will change everytime the data is loaded</span>
    eval(strcat(<span class="string">'Ten_Hz_signals_feature_'</span>, num2str(m), <span class="string">' = feature_pool;'</span>));

    load(strcat(home, <span class="string">'\Post_normalization_Ouput\Video_'</span>, num2str(m), <span class="keyword">...</span>
        <span class="string">'_ECG_feature.mat'</span>));
    eval(strcat(<span class="string">'ECG_feature_'</span>, num2str(m), <span class="string">' = feature_pool;'</span>));

    load(strcat(home, <span class="string">'\Post_normalization_Ouput\Video_'</span>, num2str(m), <span class="keyword">...</span>
        <span class="string">'_BELT_feature.mat'</span>));
    eval(strcat(<span class="string">'BELT_feature_'</span>, num2str(m), <span class="string">' = feature_pool;'</span>));

<span class="keyword">end</span>

<span class="comment">% this part can be modified (just find the max and min signal in all data)</span>
<span class="comment">% !!!</span>
</pre><h2>Normalization all together<a name="7"></a></h2><pre class="codeinput"><span class="keyword">for</span> i = 1:num_selected_signal <span class="comment">% mean, max, min ...</span>
    temp = [];
    <span class="keyword">for</span> m = 1:num_trips
        eval(strcat(<span class="string">'temp = [temp; Ten_Hz_signals_feature_'</span>, num2str(m), <span class="string">'{i,1}];'</span>));
    <span class="keyword">end</span>

    Normalized_Data = temp;       <span class="comment">% temp variables</span>
    <span class="keyword">for</span> j = 2:(num_signal_attributes + 1)
        <span class="comment">% normalize data into [0,1]</span>
        Normalized_Data(:,j) = (Normalized_Data(:,j) - min(Normalized_Data(:,j))) <span class="keyword">...</span>
            ./ (max(Normalized_Data(:,j)) - min(Normalized_Data(:,j)));
    <span class="keyword">end</span>
    <span class="comment">% Ten_Hz_signals_feature_all: 7 signals, each signal has 6 columns</span>
    <span class="comment">% (time + 5 features)</span>
    Ten_Hz_signals_feature_all{i} = Normalized_Data;
<span class="keyword">end</span>
clearvars <span class="string">temp</span>;
</pre><h2>Not use ECG and BELT data right now<a name="8"></a></h2><p>feature_All_ECG = [  feature_ECG_1; feature_ECG_2; feature_ECG_3;...                 feature_ECG_4; feature_ECG_5]; for j = 2:num_signal_attributes + 1    feature_All_ECG(:,j) = (feature_All_ECG(:,j) - min(feature_All_ECG(:,j))) ...        ./(max(feature_All_ECG(:,j)) - min(feature_All_ECG(:,j))); end</p><p>feature_All_BELT = [ feature_BELT_1; feature_BELT_2; feature_BELT_3;                 feature_BELT_4; feature_BELT_5]; for j = 2:num_signal_attributes + 1     feature_All_BELT(:,j) = (feature_All_BELT(:,j) - min(feature_All_BELT(:,j))) ...     ./(max(feature_All_BELT(:,j))-min(feature_All_BELT(:,j))); end</p><h2>Seperate each Video<a name="9"></a></h2><pre class="codeinput">offset = 0;
<span class="keyword">for</span> j = 1:num_selected_signal
     Video = Ten_Hz_signals_feature_all{j};
    <span class="keyword">for</span> m = 1:num_trips
        <span class="comment">% signal_length = Video_m__Ten_Hz_signals_length;</span>
        eval(strcat(<span class="string">'signal_length = Video_'</span>, num2str(m), <span class="string">'_Ten_Hz_signals_length;'</span>));

        <span class="comment">% seperate the video according to the the length of each signal</span>
        <span class="comment">% Video_cal_m(j) = [zeros(window_size_cal - 1, num_signal_attributes + 1); Video( (offset + 1 : offset + signal_length), : )];</span>
        eval(strcat(<span class="string">'Video_Ten_Hz_signals_feature_'</span>, num2str(m), <span class="string">'{j}  = [zeros(window_size_Ten_Hz_signals - 1, num_signal_attributes + 1); Video( (offset + 1 : offset + signal_length), : )];'</span>));
        offset = offset + signal_length;
    <span class="keyword">end</span>
    offset = 0;
<span class="keyword">end</span>
</pre><h2>add target information here<a name="10"></a></h2><pre class="codeinput"><span class="keyword">for</span> m = 1:num_trips
    load(strcat(home,<span class="string">'\Synchronized_Dataset\Video_'</span> ,num2str(m), <span class="string">'_Synchronized_Data.mat'</span>));
    <span class="keyword">for</span> i = 1:num_selected_signal
        <span class="comment">% add the target information to the end column</span>
        <span class="comment">% Ten_Hz_signals_feature_all: 7 signals, each signal has 7 columns (time + 5 features + target)</span>
        eval(strcat(<span class="string">'Video_Ten_Hz_signals_feature_'</span>, num2str(m), <span class="string">'{i} = [ Video_Ten_Hz_signals_feature_'</span>, num2str(m), <span class="string">'{i}, Ten_Hz_signals_data(:,end)];'</span>));
    <span class="keyword">end</span>
    eval(strcat(<span class="string">'Video_ECG_feature_'</span>, num2str(m), <span class="string">' = [zeros(window_size_ECG_raw - 1, num_signal_attributes); ECG_feature_'</span>, num2str(m), <span class="string">'];'</span>));
    eval(strcat(<span class="string">'Video_BELT_feature_'</span>, num2str(m), <span class="string">' = [zeros(window_size_BELT_raw - 1, num_signal_attributes); BELT_feature_'</span>, num2str(m), <span class="string">'];'</span>));
<span class="keyword">end</span>
</pre><h2>Time Matching (generalize for ECG signals)<a name="11"></a></h2><p>map the time of ECG and Belt signals into 10Hz data time</p><pre class="codeinput">size_array = [];
<span class="keyword">for</span> m = 1:num_trips
    eval(strcat(<span class="string">'size_array = [size_array; size(Video_ECG_feature_'</span>, num2str(m), <span class="string">', 1)];'</span>));
<span class="keyword">end</span>

[~, max_index] = max(size_array); <span class="comment">% find the video index which has longest ECG signal length</span>
<span class="comment">% max_Video_ECG_feature = Video_ECG_feature_num2str(maxIndex);</span>
eval(strcat(<span class="string">'max_length_Video_ECG_feature = Video_ECG_feature_'</span>, num2str(max_index), <span class="string">';'</span>));
<span class="comment">% max_Video_Ten_Hz_signals_feature = Video_Ten_Hz_signals_feature_num2str(maxIndex);</span>
<span class="comment">% extract the time column</span>
eval(strcat(<span class="string">'max_length_Video_Ten_Hz_signals_feature = Video_Ten_Hz_signals_feature_'</span>, num2str(max_index), <span class="string">'{1};'</span>))

<span class="comment">% time consuming job, and also have problem (maybe)</span>
Lookup_Table = [];      <span class="comment">% why use lookup table here?</span>
Time_sequence = max_length_Video_Ten_Hz_signals_feature(:,1);
<span class="keyword">for</span> j = window_size_Ten_Hz_signals:size(max_length_Video_Ten_Hz_signals_feature,1)
    Match_From = Time_sequence(j);
    <span class="comment">%find the index which is closet to 10Hz data Match_From</span>
    [~, Match_to_ECG] = min(abs(max_length_Video_ECG_feature(:,1) - Match_From));
    Lookup_Table = [Lookup_Table; [j, Match_to_ECG]];
<span class="keyword">end</span>

<span class="keyword">for</span> m = 1:num_trips
    <span class="comment">% find the last point coresponding index</span>
    eval(strcat(<span class="string">'index = find(Lookup_Table(:,1) == size(Video_Ten_Hz_signals_feature_'</span>, num2str(m), <span class="string">'{1},1));'</span>));
    <span class="comment">% save ECG feature data and the new time index into a new variable</span>
    eval(strcat(<span class="string">'Vedio_'</span>, num2str(m), <span class="string">'_new_ECG_feature = Video_ECG_feature_'</span>, num2str(m), <span class="string">'(Lookup_Table(1:index, 2),2:5);'</span>));
    <span class="comment">% add the number of window size 0 points at the begining</span>
    eval(strcat(<span class="string">'Vedio_'</span>, num2str(m), <span class="string">'_new_ECG_feature = [zeros(window_size_Ten_Hz_signals - 1, size(Vedio_'</span>, num2str(m), <span class="string">'_new_ECG_feature, 2)); Vedio_'</span>, num2str(m), <span class="string">'_new_ECG_feature ];'</span>));
    <span class="comment">% add new_ECG_feature into Ten_Hz_Signals_feature</span>
    eval(strcat(<span class="string">'Video_Ten_Hz_signals_feature_'</span>, num2str(m), <span class="string">' = [ Video_Ten_Hz_signals_feature_'</span>, num2str(m), <span class="string">', Vedio_'</span>, num2str(m), <span class="string">'_new_ECG_feature];'</span>));
<span class="keyword">end</span>
</pre><h2>Generalization for Belt signal<a name="12"></a></h2><pre class="codeinput">size_array = [];
<span class="keyword">for</span> m = 1:num_trips
    eval(strcat(<span class="string">'size_array = [size_array; size(Video_BELT_feature_'</span>, num2str(m), <span class="string">', 1)];'</span>));
<span class="keyword">end</span>

[~, max_index] = max(size_array); <span class="comment">% find the video index which has longest BELT signal length</span>
<span class="comment">% max_Video_BELT_feature = Video_ECG_feature_num2str(maxIndex);</span>
eval(strcat(<span class="string">'max_Video_BELT_feature = Video_BELT_feature_'</span>, num2str(max_index), <span class="string">';'</span>));
<span class="comment">% max_Video_Ten_Hz_signals_feature = Video_Ten_Hz_signals_feature_num2str(maxIndex);</span>
<span class="comment">% extract the time column</span>
eval(strcat(<span class="string">'max_Video_Ten_Hz_signals_feature = Video_Ten_Hz_signals_feature_'</span>, num2str(max_index), <span class="string">'{1};'</span>))

<span class="comment">% time consuming job, and also have problem (maybe)</span>
Lookup_Table = [];      <span class="comment">% why use lookup table here?</span>
Time_sequence = max_Video_Ten_Hz_signals_feature(:,1);
<span class="keyword">for</span> j = window_size_Ten_Hz_signals:size(max_Video_Ten_Hz_signals_feature, 1)
    Match_From = Time_sequence(j);
    <span class="comment">%find the index which is closet to 10Hz data Match_From</span>
    [~, Match_to_BELT] = min(abs(max_Video_BELT_feature(:,1) - Match_From));
    Lookup_Table = [Lookup_Table; [j, Match_to_BELT]];
<span class="keyword">end</span>

<span class="keyword">for</span> m = 1:num_trips
    <span class="comment">% find the last point coresponding index</span>
    eval(strcat(<span class="string">'index = find(Lookup_Table(:,1) == size(Video_Ten_Hz_signals_feature_'</span>, num2str(m), <span class="string">'{1},1));'</span>));
    <span class="comment">% save ECG feature data and the new time index into a new variable</span>
    eval(strcat(<span class="string">'Vedio_'</span>, num2str(m), <span class="string">'_new_BELT_feature = Video_BELT_feature_'</span>, num2str(m), <span class="string">'(Lookup_Table(1:index, 2),2:5);'</span>));
    <span class="comment">% add the number of window size 0 points at the begining</span>
    eval(strcat(<span class="string">'Vedio_'</span>, num2str(m), <span class="string">'_new_BELT_feature = [zeros(window_size_Ten_Hz_signals - 1, size(Vedio_'</span>, num2str(m), <span class="string">'_new_BELT_feature, 2)); Vedio_'</span>, num2str(m), <span class="string">'_new_BELT_feature ];'</span>));
    <span class="comment">% add new_ECG_feature into Ten_Hz_Signals_feature</span>
    eval(strcat(<span class="string">'Video_Ten_Hz_signals_feature_'</span>, num2str(m), <span class="string">' = [ Video_Ten_Hz_signals_feature_'</span>, num2str(m), <span class="string">', Vedio_'</span>, num2str(m), <span class="string">'_new_BELT_feature];'</span>));
<span class="keyword">end</span>
</pre><h2>Calculate the x(t) - x(t-stepsize)<a name="13"></a></h2><pre class="codeinput"><span class="keyword">for</span> m = 1:num_trips
    <span class="keyword">for</span> j = 1:2
      eval(strcat(<span class="string">'signal = Video_Ten_Hz_signals_feature_'</span>,num2str(m),<span class="string">'{1, num_selected_signal + j};'</span>));
      signal(:,5) = [0;diff(signal(:,1))];
      signal(20,5) = 0;
      eval(strcat(<span class="string">'Video_Ten_Hz_signals_feature_'</span>,num2str(m),<span class="string">'{1, num_selected_signal + j} = signal;'</span>))
    <span class="keyword">end</span>
<span class="keyword">end</span>
</pre><h2>Deal with ECG feature<a name="14"></a></h2><p>normalization ECG_feature_all = []; for m = 1:num_trips     eval(strcat('ECG_feature_all = [ECG_feature_all; Video_Ten_Hz_signals_feature_', num2str(m), '(:, 8)];'));     for j=1:num_signal_attributes        ECG_feature_all(:,j) = (ECG_feature_all(:,j)-min(ECG_feature_all(:,j)))./(max(ECG_feature_all(:,j))-min(ECG_feature_all(:,j)));     end end</p><p>offset = 0; for j = m:num_selected_signal      Video = ECG_feature_all{j};     for m = 1:num_trips         % signal_length = Video_m__Ten_Hz_signals_length;         eval(strcat('signal_length = Video_', num2str(m), '_Ten_Hz_signals_length;'));         % seperate the video according to the the length of each signal         % Video_cal_m(j) = [zeros(window_size_cal - 1, num_signal_attributes + 1); Video( (offset + 1 : offset + signal_length), : )];         eval(strcat('Video_ECG_feature_', num2str(m), '{j}  = [zeros(window_size_Ten_Hz_signals - 1, num_signal_attributes + 1); Video( (offset + 1 : offset + signal_length), : )];'));         offset = offset + signal_length;     end     offset = 0; end</p><h2>Deal with BELT feature<a name="15"></a></h2><p>BELT_feature_all = []; for j=1:num_signal_attributes     eval(strcat('BELT_feature_all = [BELT_feature_all; Video_Ten_Hz_signals_feature_', num2str(m), '(:, 9)];'));     featureAll_BELT(:,j)=(featureAll_BELT(:,j)-min(featureAll_BELT(:,j)))./(max(featureAll_BELT(:,j))-min(featureAll_BELT(:,j))); end</p><pre class="codeinput"><span class="comment">% L1=size(Video1{1,1},1);</span>
<span class="comment">% L2=size(Video2{1,1},1);</span>
<span class="comment">% L3=size(Video3{1,1},1);</span>
<span class="comment">% L4=size(Video4{1,1},1);</span>
<span class="comment">% L5=size(Video5{1,1},1);</span>
<span class="comment">% Video=[];</span>
<span class="comment">% Video=featureAll_ECG;</span>
<span class="comment">% Video_ECG_1=Video((1:L1),:);</span>
<span class="comment">% Video_ECG_2=Video((L1+1:L2+L1),:);</span>
<span class="comment">% Video_ECG_3=Video((L1+L2+1:L2+L1+L3),:);</span>
<span class="comment">% Video_ECG_4=Video((L1+L2+L3+1:L2+L1+L3+L4),:);</span>
<span class="comment">% Video_ECG_5=Video((L1+L2+L3+L4+1:L2+L1+L3+L4+L5),:);</span>
<span class="comment">%</span>
<span class="comment">% Video1{1,8}=Video_ECG_1;</span>
<span class="comment">% Video2{1,8}=Video_ECG_2;</span>
<span class="comment">% Video3{1,8}=Video_ECG_3;</span>
<span class="comment">% Video4{1,8}=Video_ECG_4;</span>
<span class="comment">% Video5{1,8}=Video_ECG_5;</span>
<span class="comment">%</span>
<span class="comment">% Video=[];</span>
<span class="comment">% Video=featureAll_BELT;</span>
<span class="comment">% Video_BELT_1=Video((1:L1),:);</span>
<span class="comment">% Video_BELT_2=Video((L1+1:L2+L1),:);</span>
<span class="comment">% Video_BELT_3=Video((L1+L2+1:L2+L1+L3),:);</span>
<span class="comment">% Video_BELT_4=Video((L1+L2+L3+1:L2+L1+L3+L4),:);</span>
<span class="comment">% Video_BELT_5=Video((L1+L2+L3+L4+1:L2+L1+L3+L4+L5),:);</span>
<span class="comment">% Video1{1,9}=Video_BELT_1;</span>
<span class="comment">% Video2{1,9}=Video_BELT_2;</span>
<span class="comment">% Video3{1,9}=Video_BELT_3;</span>
<span class="comment">% Video4{1,9}=Video_BELT_4;</span>
<span class="comment">% Video5{1,9}=Video_BELT_5;</span>
<span class="comment">% for m=1:NumberofTrips</span>
<span class="comment">%     for j=8:9</span>
<span class="comment">%         eval(strcat('Video=','Video',num2str(m),'{1,j};'));</span>
<span class="comment">%         Video=[zeros(size(Video,1),1),Video,zeros(size(Video,1),1)];</span>
<span class="comment">%         eval(strcat('Video',num2str(m),'{1,j}=Video;'));</span>
<span class="comment">%     end</span>
<span class="comment">% end</span>
<span class="comment">% save(strcat(Outroot_origin,'\DataSet\Video_final.mat'),'Video1','Video2','Video3','Video4','Video5');</span>
<span class="comment">% Extract Lane-Change period</span>
<span class="comment">% load(strcat(Outroot_origin,'\DataSet\Video_final.mat'));</span>
<span class="comment">% for j=1:NumberofTrips</span>
<span class="comment">%</span>
<span class="comment">% eval(strcat('dataAll_cell=Video',num2str(j),';'));</span>
<span class="comment">% dataAll=dataAll_cell{1};</span>
<span class="comment">% targetindex1=find(dataAll(:,end)==1);</span>
<span class="comment">% targetindex2=find(dataAll(:,end)==2);</span>
<span class="comment">% ID1=[];</span>
<span class="comment">% ID2=[];</span>
<span class="comment">% for m=1:length(targetindex1)-1</span>
<span class="comment">%     if(m==1)</span>
<span class="comment">%     ID1=targetindex1(1);</span>
<span class="comment">%     end</span>
<span class="comment">%     if(targetindex1(m+1)&gt;targetindex1(m)+2)</span>
<span class="comment">%     ID1=[ID1,targetindex1(m+1)];</span>
<span class="comment">%     end</span>
<span class="comment">% end</span>
<span class="comment">% for m=1:length(targetindex2)-1</span>
<span class="comment">%     if(m==1)</span>
<span class="comment">%     ID2=targetindex2(1);</span>
<span class="comment">%     end</span>
<span class="comment">%     if(targetindex2(m+1)&gt;targetindex2(m)+2)</span>
<span class="comment">%     ID2=[ID2,targetindex2(m+1)];</span>
<span class="comment">%     end</span>
<span class="comment">% end</span>
<span class="comment">% LaneChangeOldInd=ID1/10;</span>
<span class="comment">% NolangechangeInd=ID2/10;</span>
<span class="comment">% NoLane=NolangechangeInd*10+1-time_before_LC;</span>
<span class="comment">% LaneBefore=LaneChangeOldInd*10+1-time_before_LC;% at this time</span>
<span class="comment">% [x1,y1]=size(LaneBefore);</span>
<span class="comment">% [x2,y2]=size(NoLane);</span>
<span class="comment">% NumberofSignalSelected=9;</span>
<span class="comment">% for m=1:NumberofSignalSelected</span>
<span class="comment">%     eval(strcat('invoker=Video',num2str(j),'{1,i};'));</span>
<span class="comment">%     for index=1:y1</span>
<span class="comment">%         pointIndex=LaneBefore(index);</span>
<span class="comment">%         middle=[middle;invoker((pointIndex:(pointIndex+lanechangesize-1)),2:6)];</span>
<span class="comment">%     end</span>
<span class="comment">%     eval(strcat('Video',num2str(j),'{2,i}=middle;'));</span>
<span class="comment">%     middle=[];</span>
<span class="comment">% end</span>
<span class="comment">%</span>
<span class="comment">% for m=1:NumberofSignalSelected</span>
<span class="comment">%     eval(strcat('invoker=Video',num2str(j),'{1,i};'));</span>
<span class="comment">%     eval(strcat('middle=Video',num2str(j),'{2,i};'));</span>
<span class="comment">%     for index=1:y2</span>
<span class="comment">%         pointIndex=NoLane(index);</span>
<span class="comment">%         middle=[middle;invoker((pointIndex:(pointIndex+lanechangesize-1)),2:6)];</span>
<span class="comment">%     end</span>
<span class="comment">%     eval(strcat('Video',num2str(j),'{2,i}=middle;'));</span>
<span class="comment">%     middle=[];</span>
<span class="comment">% end</span>
<span class="comment">% end</span>
<span class="comment">% feature=[Video1{2,WhichSignal};Video2{2,WhichSignal};Video3{2,WhichSignal};Video4{2,WhichSignal};Video5{2,WhichSignal}];</span>
<span class="comment">% K1=size(Video1{2,WhichSignal},1);</span>
<span class="comment">% K2=size(Video2{2,WhichSignal},1);</span>
<span class="comment">% K3=size(Video3{2,WhichSignal},1);</span>
<span class="comment">% K4=size(Video4{2,WhichSignal},1);</span>
<span class="comment">% K5=size(Video5{2,WhichSignal},1);</span>
<span class="comment">% Target=[ones(1,K1/3),zeros(1,K1*2/3),ones(1,K2/3),zeros(1,K2*2/3),ones(1,K3/3),zeros(1,K3*2/3),ones(1,K4/3),zeros(1,K4*2/3),ones(1,K5/3),zeros(1,K5*2/3)]';</span>
<span class="comment">% save(strcat(rootIn,'\DataSet\Video.mat'),'Video1','Video2','Video3','Video4','Video5');</span>
</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2014b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Post_normalization

%% Description
%%
%  File type:    Executable file

%%
%  Summary:
%  5 Features:
%
% * raw data 
% * max value
% * min value
% * mean value
% * first order difference

%%
%  Examples: 
%Provide sample usage code here

%%
%  Algorithm:
%df
%dsf
%  Author:       Yuan Ma
%  Date:         Oct.17.2014
%  Revision:     0.1
%  Partner:      Worked with Tianyu Wang, Yulong Li
%  Copyright:    Intelligent System Laboratory
%                University of Michigan Dearborn

%% Combine five Videos together
clc; clear all; close all;
ini = IniConfig();
ini.ReadFile('configuration.ini');
Data_Path = ini.GetValues('Path Setting', 'DATA_PATH');
home = ini.GetValues('Path Setting', 'HOME_PATH');

total_feature = 5;

window_size_Ten_Hz_signals      = 20;
% window size for ECG raw data is 256 because the sampling rate is 256 Hz
window_size_ECG_raw             = 256 * 2;
% window size for BELT raw data is 26 because the sampling rate is 26 Hz
window_size_BELT_raw            = 26 * 2;

load(strcat(home, '\Synchronized_Dataset\statistics.mat'));
% get the number of signal selected
% get the lane change number

num_signal_attributes   = 5;

for m = 1:num_trips
    load(strcat(home, '\Post_normalization_Ouput\Video_', num2str(m), ...
        '_Ten_Hz_signals_feature.mat'));
    % dynamic generate varibles using eval function
    % the value of feature_pool will change everytime the data is loaded
    eval(strcat('Ten_Hz_signals_feature_', num2str(m), ' = feature_pool;'));  

    load(strcat(home, '\Post_normalization_Ouput\Video_', num2str(m), ...
        '_ECG_feature.mat'));
    eval(strcat('ECG_feature_', num2str(m), ' = feature_pool;'));

    load(strcat(home, '\Post_normalization_Ouput\Video_', num2str(m), ... 
        '_BELT_feature.mat'));
    eval(strcat('BELT_feature_', num2str(m), ' = feature_pool;'));
    
end

% this part can be modified (just find the max and min signal in all data)
% !!!
%% Normalization all together
for i = 1:num_selected_signal % mean, max, min ...
    temp = [];
    for m = 1:num_trips
        eval(strcat('temp = [temp; Ten_Hz_signals_feature_', num2str(m), '{i,1}];'));
    end  
    
    Normalized_Data = temp;       % temp variables
    for j = 2:(num_signal_attributes + 1)
        % normalize data into [0,1]
        Normalized_Data(:,j) = (Normalized_Data(:,j) - min(Normalized_Data(:,j))) ...
            ./ (max(Normalized_Data(:,j)) - min(Normalized_Data(:,j)));   
    end
    % Ten_Hz_signals_feature_all: 7 signals, each signal has 6 columns
    % (time + 5 features)
    Ten_Hz_signals_feature_all{i} = Normalized_Data;
end
clearvars temp;
%% Not use ECG and BELT data right now
% feature_All_ECG = [  feature_ECG_1; feature_ECG_2; feature_ECG_3;...
%                 feature_ECG_4; feature_ECG_5];
% for j = 2:num_signal_attributes + 1
%    feature_All_ECG(:,j) = (feature_All_ECG(:,j) - min(feature_All_ECG(:,j))) ...
%        ./(max(feature_All_ECG(:,j)) - min(feature_All_ECG(:,j)));
% end  
% 
% feature_All_BELT = [ feature_BELT_1; feature_BELT_2; feature_BELT_3;
%                 feature_BELT_4; feature_BELT_5];              
% for j = 2:num_signal_attributes + 1
%     feature_All_BELT(:,j) = (feature_All_BELT(:,j) - min(feature_All_BELT(:,j))) ...
%     ./(max(feature_All_BELT(:,j))-min(feature_All_BELT(:,j)));
% end

%%  Seperate each Video
offset = 0;
for j = 1:num_selected_signal
     Video = Ten_Hz_signals_feature_all{j};
    for m = 1:num_trips
        % signal_length = Video_m__Ten_Hz_signals_length;
        eval(strcat('signal_length = Video_', num2str(m), '_Ten_Hz_signals_length;'));
        
        % seperate the video according to the the length of each signal
        % Video_cal_m(j) = [zeros(window_size_cal - 1, num_signal_attributes + 1); Video( (offset + 1 : offset + signal_length), : )];
        eval(strcat('Video_Ten_Hz_signals_feature_', num2str(m), '{j}  = [zeros(window_size_Ten_Hz_signals - 1, num_signal_attributes + 1); Video( (offset + 1 : offset + signal_length), : )];'));
        offset = offset + signal_length;
    end
    offset = 0;
end

%% add target information here
for m = 1:num_trips
    load(strcat(home,'\Synchronized_Dataset\Video_' ,num2str(m), '_Synchronized_Data.mat'));
    for i = 1:num_selected_signal
        % add the target information to the end column
        % Ten_Hz_signals_feature_all: 7 signals, each signal has 7 columns (time + 5 features + target)
        eval(strcat('Video_Ten_Hz_signals_feature_', num2str(m), '{i} = [ Video_Ten_Hz_signals_feature_', num2str(m), '{i}, Ten_Hz_signals_data(:,end)];'));
    end
    eval(strcat('Video_ECG_feature_', num2str(m), ' = [zeros(window_size_ECG_raw - 1, num_signal_attributes); ECG_feature_', num2str(m), '];'));
    eval(strcat('Video_BELT_feature_', num2str(m), ' = [zeros(window_size_BELT_raw - 1, num_signal_attributes); BELT_feature_', num2str(m), '];'));
end

%% Time Matching (generalize for ECG signals)
% map the time of ECG and Belt signals into 10Hz data time
size_array = [];
for m = 1:num_trips
    eval(strcat('size_array = [size_array; size(Video_ECG_feature_', num2str(m), ', 1)];'));
end

[~, max_index] = max(size_array); % find the video index which has longest ECG signal length
% max_Video_ECG_feature = Video_ECG_feature_num2str(maxIndex);
eval(strcat('max_length_Video_ECG_feature = Video_ECG_feature_', num2str(max_index), ';'));
% max_Video_Ten_Hz_signals_feature = Video_Ten_Hz_signals_feature_num2str(maxIndex);
% extract the time column
eval(strcat('max_length_Video_Ten_Hz_signals_feature = Video_Ten_Hz_signals_feature_', num2str(max_index), '{1};'))

% time consuming job, and also have problem (maybe)
Lookup_Table = [];      % why use lookup table here?
Time_sequence = max_length_Video_Ten_Hz_signals_feature(:,1);
for j = window_size_Ten_Hz_signals:size(max_length_Video_Ten_Hz_signals_feature,1)
    Match_From = Time_sequence(j);
    %find the index which is closet to 10Hz data Match_From
    [~, Match_to_ECG] = min(abs(max_length_Video_ECG_feature(:,1) - Match_From));
    Lookup_Table = [Lookup_Table; [j, Match_to_ECG]];
end

for m = 1:num_trips
    % find the last point coresponding index
    eval(strcat('index = find(Lookup_Table(:,1) == size(Video_Ten_Hz_signals_feature_', num2str(m), '{1},1));'));
    % save ECG feature data and the new time index into a new variable 
    eval(strcat('Vedio_', num2str(m), '_new_ECG_feature = Video_ECG_feature_', num2str(m), '(Lookup_Table(1:index, 2),2:5);'));
    % add the number of window size 0 points at the begining
    eval(strcat('Vedio_', num2str(m), '_new_ECG_feature = [zeros(window_size_Ten_Hz_signals - 1, size(Vedio_', num2str(m), '_new_ECG_feature, 2)); Vedio_', num2str(m), '_new_ECG_feature ];'));
    % add new_ECG_feature into Ten_Hz_Signals_feature
    eval(strcat('Video_Ten_Hz_signals_feature_', num2str(m), ' = [ Video_Ten_Hz_signals_feature_', num2str(m), ', Vedio_', num2str(m), '_new_ECG_feature];'));
end

%% Generalization for Belt signal
size_array = [];
for m = 1:num_trips
    eval(strcat('size_array = [size_array; size(Video_BELT_feature_', num2str(m), ', 1)];'));
end

[~, max_index] = max(size_array); % find the video index which has longest BELT signal length
% max_Video_BELT_feature = Video_ECG_feature_num2str(maxIndex);
eval(strcat('max_Video_BELT_feature = Video_BELT_feature_', num2str(max_index), ';'));
% max_Video_Ten_Hz_signals_feature = Video_Ten_Hz_signals_feature_num2str(maxIndex);
% extract the time column
eval(strcat('max_Video_Ten_Hz_signals_feature = Video_Ten_Hz_signals_feature_', num2str(max_index), '{1};'))

% time consuming job, and also have problem (maybe)
Lookup_Table = [];      % why use lookup table here?
Time_sequence = max_Video_Ten_Hz_signals_feature(:,1);
for j = window_size_Ten_Hz_signals:size(max_Video_Ten_Hz_signals_feature, 1)
    Match_From = Time_sequence(j);
    %find the index which is closet to 10Hz data Match_From
    [~, Match_to_BELT] = min(abs(max_Video_BELT_feature(:,1) - Match_From));
    Lookup_Table = [Lookup_Table; [j, Match_to_BELT]];
end

for m = 1:num_trips
    % find the last point coresponding index
    eval(strcat('index = find(Lookup_Table(:,1) == size(Video_Ten_Hz_signals_feature_', num2str(m), '{1},1));'));
    % save ECG feature data and the new time index into a new variable 
    eval(strcat('Vedio_', num2str(m), '_new_BELT_feature = Video_BELT_feature_', num2str(m), '(Lookup_Table(1:index, 2),2:5);'));
    % add the number of window size 0 points at the begining
    eval(strcat('Vedio_', num2str(m), '_new_BELT_feature = [zeros(window_size_Ten_Hz_signals - 1, size(Vedio_', num2str(m), '_new_BELT_feature, 2)); Vedio_', num2str(m), '_new_BELT_feature ];'));
    % add new_ECG_feature into Ten_Hz_Signals_feature
    eval(strcat('Video_Ten_Hz_signals_feature_', num2str(m), ' = [ Video_Ten_Hz_signals_feature_', num2str(m), ', Vedio_', num2str(m), '_new_BELT_feature];'));
end

%% Calculate the x(t) - x(t-stepsize)
for m = 1:num_trips
    for j = 1:2
      eval(strcat('signal = Video_Ten_Hz_signals_feature_',num2str(m),'{1, num_selected_signal + j};')); 
      signal(:,5) = [0;diff(signal(:,1))];
      signal(20,5) = 0;
      eval(strcat('Video_Ten_Hz_signals_feature_',num2str(m),'{1, num_selected_signal + j} = signal;'))
    end
end


%% Deal with ECG feature
% normalization
% ECG_feature_all = [];
% for m = 1:num_trips
%     eval(strcat('ECG_feature_all = [ECG_feature_all; Video_Ten_Hz_signals_feature_', num2str(m), '(:, 8)];'));
%     for j=1:num_signal_attributes
%        ECG_feature_all(:,j) = (ECG_feature_all(:,j)-min(ECG_feature_all(:,j)))./(max(ECG_feature_all(:,j))-min(ECG_feature_all(:,j)));
%     end
% end
% 
% offset = 0;
% for j = m:num_selected_signal
%      Video = ECG_feature_all{j};
%     for m = 1:num_trips
%         % signal_length = Video_m__Ten_Hz_signals_length;
%         eval(strcat('signal_length = Video_', num2str(m), '_Ten_Hz_signals_length;'));
%         % seperate the video according to the the length of each signal
%         % Video_cal_m(j) = [zeros(window_size_cal - 1, num_signal_attributes + 1); Video( (offset + 1 : offset + signal_length), : )];
%         eval(strcat('Video_ECG_feature_', num2str(m), '{j}  = [zeros(window_size_Ten_Hz_signals - 1, num_signal_attributes + 1); Video( (offset + 1 : offset + signal_length), : )];'));
%         offset = offset + signal_length;
%     end
%     offset = 0;
% end

%% Deal with BELT feature
% BELT_feature_all = [];
% for j=1:num_signal_attributes
%     eval(strcat('BELT_feature_all = [BELT_feature_all; Video_Ten_Hz_signals_feature_', num2str(m), '(:, 9)];'));
%     featureAll_BELT(:,j)=(featureAll_BELT(:,j)-min(featureAll_BELT(:,j)))./(max(featureAll_BELT(:,j))-min(featureAll_BELT(:,j)));
% end

% L1=size(Video1{1,1},1);
% L2=size(Video2{1,1},1);
% L3=size(Video3{1,1},1);
% L4=size(Video4{1,1},1);
% L5=size(Video5{1,1},1);
% Video=[];
% Video=featureAll_ECG;
% Video_ECG_1=Video((1:L1),:);
% Video_ECG_2=Video((L1+1:L2+L1),:);
% Video_ECG_3=Video((L1+L2+1:L2+L1+L3),:);
% Video_ECG_4=Video((L1+L2+L3+1:L2+L1+L3+L4),:);
% Video_ECG_5=Video((L1+L2+L3+L4+1:L2+L1+L3+L4+L5),:);
% 
% Video1{1,8}=Video_ECG_1;
% Video2{1,8}=Video_ECG_2;
% Video3{1,8}=Video_ECG_3;
% Video4{1,8}=Video_ECG_4;
% Video5{1,8}=Video_ECG_5;
% 
% Video=[];
% Video=featureAll_BELT;
% Video_BELT_1=Video((1:L1),:);
% Video_BELT_2=Video((L1+1:L2+L1),:);
% Video_BELT_3=Video((L1+L2+1:L2+L1+L3),:);
% Video_BELT_4=Video((L1+L2+L3+1:L2+L1+L3+L4),:);
% Video_BELT_5=Video((L1+L2+L3+L4+1:L2+L1+L3+L4+L5),:);
% Video1{1,9}=Video_BELT_1;
% Video2{1,9}=Video_BELT_2;
% Video3{1,9}=Video_BELT_3;
% Video4{1,9}=Video_BELT_4;
% Video5{1,9}=Video_BELT_5;
% for m=1:NumberofTrips
%     for j=8:9
%         eval(strcat('Video=','Video',num2str(m),'{1,j};'));
%         Video=[zeros(size(Video,1),1),Video,zeros(size(Video,1),1)];
%         eval(strcat('Video',num2str(m),'{1,j}=Video;'));
%     end
% end
% save(strcat(Outroot_origin,'\DataSet\Video_final.mat'),'Video1','Video2','Video3','Video4','Video5');
% Extract Lane-Change period
% load(strcat(Outroot_origin,'\DataSet\Video_final.mat'));
% for j=1:NumberofTrips
% 
% eval(strcat('dataAll_cell=Video',num2str(j),';'));
% dataAll=dataAll_cell{1};
% targetindex1=find(dataAll(:,end)==1);
% targetindex2=find(dataAll(:,end)==2);
% ID1=[];
% ID2=[];
% for m=1:length(targetindex1)-1
%     if(m==1)
%     ID1=targetindex1(1);
%     end
%     if(targetindex1(m+1)>targetindex1(m)+2)
%     ID1=[ID1,targetindex1(m+1)];
%     end
% end
% for m=1:length(targetindex2)-1
%     if(m==1)
%     ID2=targetindex2(1);
%     end
%     if(targetindex2(m+1)>targetindex2(m)+2)
%     ID2=[ID2,targetindex2(m+1)];
%     end
% end
% LaneChangeOldInd=ID1/10;
% NolangechangeInd=ID2/10;
% NoLane=NolangechangeInd*10+1-time_before_LC;
% LaneBefore=LaneChangeOldInd*10+1-time_before_LC;% at this time
% [x1,y1]=size(LaneBefore);
% [x2,y2]=size(NoLane);
% NumberofSignalSelected=9;
% for m=1:NumberofSignalSelected
%     eval(strcat('invoker=Video',num2str(j),'{1,i};'));
%     for index=1:y1
%         pointIndex=LaneBefore(index);
%         middle=[middle;invoker((pointIndex:(pointIndex+lanechangesize-1)),2:6)];
%     end
%     eval(strcat('Video',num2str(j),'{2,i}=middle;'));
%     middle=[];
% end
% 
% for m=1:NumberofSignalSelected
%     eval(strcat('invoker=Video',num2str(j),'{1,i};'));
%     eval(strcat('middle=Video',num2str(j),'{2,i};'));
%     for index=1:y2
%         pointIndex=NoLane(index); 
%         middle=[middle;invoker((pointIndex:(pointIndex+lanechangesize-1)),2:6)];
%     end
%     eval(strcat('Video',num2str(j),'{2,i}=middle;'));
%     middle=[];
% end
% end
% feature=[Video1{2,WhichSignal};Video2{2,WhichSignal};Video3{2,WhichSignal};Video4{2,WhichSignal};Video5{2,WhichSignal}];
% K1=size(Video1{2,WhichSignal},1);
% K2=size(Video2{2,WhichSignal},1);
% K3=size(Video3{2,WhichSignal},1);
% K4=size(Video4{2,WhichSignal},1);
% K5=size(Video5{2,WhichSignal},1);
% Target=[ones(1,K1/3),zeros(1,K1*2/3),ones(1,K2/3),zeros(1,K2*2/3),ones(1,K3/3),zeros(1,K3*2/3),ones(1,K4/3),zeros(1,K4*2/3),ones(1,K5/3),zeros(1,K5*2/3)]';
% save(strcat(rootIn,'\DataSet\Video.mat'),'Video1','Video2','Video3','Video4','Video5');



##### SOURCE END #####
--></body></html>