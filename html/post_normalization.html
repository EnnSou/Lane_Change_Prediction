
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Post_normalization</title><meta name="generator" content="MATLAB 8.3"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2014-10-17"><meta name="DC.source" content="post_normalization.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Post_normalization</h1><!--introduction--><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Description</a></li><li><a href="#8">Initialization</a></li><li><a href="#9">define variables</a></li><li><a href="#12">Granger Causality Analysis</a></li><li><a href="#15">calculate features of 10 Hz features</a></li><li><a href="#16">calculate ECG feature 256Hz</a></li><li><a href="#17">calculate BELT 25.6Hz</a></li></ul></div><h2>Description<a name="1"></a></h2><pre>File type:    Executable file</pre><pre>Summary:
5 Features:</pre><div><ul><li>raw data</li><li>max value</li><li>min value</li><li>mean value</li><li>first order difference</li></ul></div><pre>Examples:</pre><pre class="codeinput"><span class="comment">%Provide sample usage code here</span>
</pre><pre>Algorithm:</pre><pre class="codeinput"><span class="comment">%df</span>
<span class="comment">%dsf</span>
</pre><pre>See also:
* ITEM1
* ITEM2</pre><pre>Author:       Yuan Ma
Date:         Oct.17.2014
Revision:     0.1
Partner:      Worked with Tianyu Wang, Yulong Li
Copyright:    Intelligent System Laboratory
              University of Michigan Dearborn</pre><h2>Initialization<a name="8"></a></h2><pre class="codeinput">clear <span class="string">all</span>; clc;
<span class="comment">%# warning off;</span>
</pre><h2>define variables<a name="9"></a></h2><pre class="codeinput">root_path = <span class="string">'./tempdata/'</span>;
outroot_origin = <span class="string">'./tempdata/'</span>;
Total_Lane_Change = 31;     <span class="comment">% Changable if having new data</span>
Number_LC_Test=3;         <span class="comment">% Changable</span>
</pre><p>Architecture of neual network</p><pre class="codeinput">hidden_nodes = 15;
learning_rates = 0.05;
Num_Signal_Selected = 7;
num_Trips = 5;                  <span class="comment">% 5 trips in total (Kunqiao's data)</span>
methods_fre={<span class="string">'welch'</span>};          <span class="comment">% ?</span>
<span class="comment">%# WhichSignal=1;</span>
</pre><p>allocate memeories to be used</p><pre class="codeinput">feature = [];
target  = [];
feature_Filter = 1:45;    <span class="comment">% 9 signals * 5 features</span>
all_Features = {};        <span class="comment">% cell</span>
step_Size = 1;            <span class="comment">% move one point every window shift</span>
num_total_Features = 5;

video1 = {}; video2 = {}; video3 = {}; video4 = {}; video5 = {};

time_before_LC      = 20; <span class="comment">% time before lane change: 20 points</span>
lane_change_size    = 20; <span class="comment">% lange change size is 20 points</span>
num_points_on_event = 20; <span class="comment">% changable</span>

skip = 1;                 <span class="comment">% IMPORTANT FLAG, changable</span>

middle = [];                    <span class="comment">% ?</span>
window_size_cal      = 20;      <span class="comment">%</span>
window_size_ECG_raw  = 256*2;   <span class="comment">% window size of feature extracting for ECG raw data</span>
window_size_BELT_raw = 26*2;    <span class="comment">% window size of feature extracting for BELT raw data</span>
num_of_Features      = 5;
</pre><h2>Granger Causality Analysis<a name="12"></a></h2><pre class="codeinput"><span class="keyword">for</span> i = 1: num_Trips
</pre><pre class="codeinput">    <span class="keyword">if</span> (skip == 1)          <span class="comment">% Don't want to regenerate train and test data</span>
        <span class="keyword">break</span>
    <span class="keyword">end</span>
    disp(i)                 <span class="comment">% DEBUG MESSAGE</span>

    window_segment_cal   = {};
    window_segment_ECG   = {};
    window_segment_BELT  = {};
</pre><h2>calculate features of 10 Hz features<a name="15"></a></h2><pre class="codeinput">    Feature             = {};
    feature             = [];
    feature_vector_1    = [];

    <span class="comment">% load 'synDataAll_trip_number.mat' data</span>
    load(strcat(root_path,<span class="string">'synDataAll_'</span>,num2str(i),<span class="string">'.mat'</span>));

    <span class="comment">% Adding windows</span>
    vedio_Length = size(dataAll_cal,1);     <span class="comment">% number of data point in a video?</span>

    <span class="comment">% save value 1 point before</span>
    cal_before = data_All_cal(window_size_cal-1,:);
    ECG_before = data_All_ECG(window_size_ECG_raw-1,:);
    BELT_before = dataAll_BELT(window_size_BELT_raw-1,:);

    <span class="comment">% for every selected signal</span>
    <span class="keyword">for</span> k = 2:(Num_Signal_Selected + 1)
        <span class="comment">% for data in every shifted window</span>
        <span class="keyword">for</span> j = 1:step_size:(vedio_Length-(window_size_cal-1))
            windowIndex = [j:(j+(window_size_cal-1))];
            Signal = dataAll_cal(windowIndex,k);
            feature(1,1) = Signal(end,1);
            feature(1,2) = max(Signal);
            feature(1,3) = min(Signal);
            feature(1,4) = mean(Signal);
            feature(1,5) = Signal(end,1)-Signal(end-1,1); <span class="comment">% first order defference</span>
            <span class="comment">% feature vector combine 5 features above</span>
            feature_vector_1(j,:) = feature;
        <span class="keyword">end</span>
        Feature{k-1,1} = [data_All_cal((window_size_cal:end),1),feature_vector_1];
    <span class="keyword">end</span>

    eval(strcat(<span class="string">'L_cal'</span>,num2str(i),<span class="string">'=size(featvec1,1);'</span>));
    save(strcat(root_path,<span class="string">'feature_cal_'</span>,num2str(i),<span class="string">'.mat'</span>),<span class="string">'Feature'</span>, <span class="keyword">...</span>
        strcat(<span class="string">'L_cal'</span>,num2str(i)),<span class="string">'cal_before'</span>);
</pre><h2>calculate ECG feature 256Hz<a name="16"></a></h2><pre class="codeinput">   feature_vector_1 = [];
   Feature          = [];
   feature          = [];
   LengthVideo = size(dataAll_ECG,1);

   <span class="keyword">for</span> j = 1:stepsize:(LengthVideo-(window_size_ECG_raw-1))
       windowIndex = j:(j+(window_size_ECG_raw-1));

        Signal = data_All_ECG(windowIndex,2);
        feature(1,1) = Signal(end,1);
        feature(1,2) = max(Signal);
        feature(1,3) = min(Signal);
        feature(1,4) = mean(Signal);
        feature_vector_1(j,:)=feature;
   <span class="keyword">end</span>

   Feature = [dataAll_ECG((window_size_ECG_raw:end),1),feature_vector_1];
   eval(strcat(<span class="string">'L_ECG'</span>,num2str(i),<span class="string">'=size(featvec1,1);'</span>));
   save(strcat(rootIn,<span class="string">'feature_ECG_'</span>,num2str(i),<span class="string">'.mat'</span>),<span class="string">'Feature'</span>, <span class="keyword">...</span>
       strcat(<span class="string">'L_ECG'</span>,num2str(i)),<span class="string">'ECG_before'</span>);
</pre><h2>calculate BELT 25.6Hz<a name="17"></a></h2><pre class="codeinput">   feature_vector_1 = [];
   Feature          = [];
   feature          = [];
   LengthVideo = size(dataAll_BELT,1);

   <span class="keyword">for</span> j = 1:stepsize:(LengthVideo-(window_size_BELT_raw-1))
       windowIndex = [j:(j+(window_size_BELT_raw-1))];
       Signal = dataAll_BELT(windowIndex,2);
       feature(1,1) = Signal(end,1);
       feature(1,2) = max(Signal);
       feature(1,3) = min(Signal);
       feature(1,4) = mean(Signal);
       feature_vector_1(j,:) = feature;
   <span class="keyword">end</span>

   Feature = [dataAll_BELT((window_size_BELT_raw:end),1),feature_vector_1];
   eval(strcat(<span class="string">'L_BELT'</span>,num2str(i),<span class="string">'=size(featvec1,1);'</span>));
   save(strcat(rootIn,<span class="string">'feature_BELT_'</span>,num2str(i),<span class="string">'.mat'</span>),<span class="string">'Feature'</span>,strcat(<span class="string">'L_BELT'</span>,num2str(i)),<span class="string">'BELT_before'</span>);
</pre><pre class="codeinput"><span class="keyword">end</span>
</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2014a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Post_normalization

%% Description
%%
%  File type:    Executable file

%%
%  Summary:
%  5 Features:
%
% * raw data 
% * max value
% * min value
% * mean value
% * first order difference

%%
%  Examples: 
%Provide sample usage code here

%%
%  Algorithm:
%df
%dsf

%%
%  See also:
% * ITEM1
% * ITEM2

%%
%  Author:       Yuan Ma
%  Date:         Oct.17.2014
%  Revision:     0.1
%  Partner:      Worked with Tianyu Wang, Yulong Li
%  Copyright:    Intelligent System Laboratory
%                University of Michigan Dearborn

%% Initialization
clear all; clc;
%# warning off;

%% define variables
root_path = './tempdata/';
outroot_origin = './tempdata/';
Total_Lane_Change = 31;     % Changable if having new data
Number_LC_Test=3;         % Changable

%%
% Architecture of neual network
hidden_nodes = 15;
learning_rates = 0.05;
Num_Signal_Selected = 7;
num_Trips = 5;                  % 5 trips in total (Kunqiao's data)
methods_fre={'welch'};          % ?
%# WhichSignal=1;

%%
% allocate memeories to be used
feature = [];
target  = [];
feature_Filter = 1:45;    % 9 signals * 5 features
all_Features = {};        % cell
step_Size = 1;            % move one point every window shift
num_total_Features = 5;

video1 = {}; video2 = {}; video3 = {}; video4 = {}; video5 = {};

time_before_LC      = 20; % time before lane change: 20 points
lane_change_size    = 20; % lange change size is 20 points
num_points_on_event = 20; % changable

skip = 1;                 % IMPORTANT FLAG, changable

middle = [];                    % ?
window_size_cal      = 20;      %
window_size_ECG_raw  = 256*2;   % window size of feature extracting for ECG raw data
window_size_BELT_raw = 26*2;    % window size of feature extracting for BELT raw data
num_of_Features      = 5;

%% Granger Causality Analysis

%%
for i = 1: num_Trips
    if (skip == 1)          % Don't want to regenerate train and test data
        break
    end
    disp(i)                 % DEBUG MESSAGE
    
    window_segment_cal   = {};
    window_segment_ECG   = {};
    window_segment_BELT  = {};
    
    %% calculate features of 10 Hz features
    Feature             = {};
    feature             = [];
    feature_vector_1    = [];
    
    % load 'synDataAll_trip_number.mat' data
    load(strcat(root_path,'synDataAll_',num2str(i),'.mat'));
    
    % Adding windows
    vedio_Length = size(dataAll_cal,1);     % number of data point in a video?
    
    % save value 1 point before
    cal_before = data_All_cal(window_size_cal-1,:);
    ECG_before = data_All_ECG(window_size_ECG_raw-1,:);
    BELT_before = dataAll_BELT(window_size_BELT_raw-1,:);
    
    % for every selected signal
    for k = 2:(Num_Signal_Selected + 1)
        % for data in every shifted window
        for j = 1:step_size:(vedio_Length-(window_size_cal-1))                               
            windowIndex = [j:(j+(window_size_cal-1))];
            Signal = dataAll_cal(windowIndex,k);
            feature(1,1) = Signal(end,1);
            feature(1,2) = max(Signal);
            feature(1,3) = min(Signal);
            feature(1,4) = mean(Signal);
            feature(1,5) = Signal(end,1)-Signal(end-1,1); % first order defference
            % feature vector combine 5 features above
            feature_vector_1(j,:) = feature;
        end
        Feature{k-1,1} = [data_All_cal((window_size_cal:end),1),feature_vector_1];
    end
    
    eval(strcat('L_cal',num2str(i),'=size(featvec1,1);'));
    save(strcat(root_path,'feature_cal_',num2str(i),'.mat'),'Feature', ...
        strcat('L_cal',num2str(i)),'cal_before');
   
   %% calculate ECG feature 256Hz
   feature_vector_1 = [];
   Feature          = [];
   feature          = [];
   LengthVideo = size(dataAll_ECG,1);
   
   for j = 1:stepsize:(LengthVideo-(window_size_ECG_raw-1))                               
       windowIndex = j:(j+(window_size_ECG_raw-1));
   
        Signal = data_All_ECG(windowIndex,2);
        feature(1,1) = Signal(end,1);
        feature(1,2) = max(Signal);
        feature(1,3) = min(Signal);
        feature(1,4) = mean(Signal);
        feature_vector_1(j,:)=feature; 
   end
   
   Feature = [dataAll_ECG((window_size_ECG_raw:end),1),feature_vector_1];
   eval(strcat('L_ECG',num2str(i),'=size(featvec1,1);'));
   save(strcat(rootIn,'feature_ECG_',num2str(i),'.mat'),'Feature', ...
       strcat('L_ECG',num2str(i)),'ECG_before');
   
   %% calculate BELT 25.6Hz
   feature_vector_1 = [];
   Feature          = [];
   feature          = [];
   LengthVideo = size(dataAll_BELT,1);
   
   for j = 1:stepsize:(LengthVideo-(window_size_BELT_raw-1))                               
       windowIndex = [j:(j+(window_size_BELT_raw-1))];
       Signal = dataAll_BELT(windowIndex,2);
       feature(1,1) = Signal(end,1);
       feature(1,2) = max(Signal);
       feature(1,3) = min(Signal);
       feature(1,4) = mean(Signal);
       feature_vector_1(j,:) = feature; 
   end
   
   Feature = [dataAll_BELT((window_size_BELT_raw:end),1),feature_vector_1];
   eval(strcat('L_BELT',num2str(i),'=size(featvec1,1);'));
   save(strcat(rootIn,'feature_BELT_',num2str(i),'.mat'),'Feature',strcat('L_BELT',num2str(i)),'BELT_before');
   
end

##### SOURCE END #####
--></body></html>